<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="css/main.css" />
  <title>E-Commerce | Profile</title>
</head>

<body>
  <!-- header -->
  <header>
    <div class="global-notification">
      <div class="container">
        <p>
          SUMMER SALE FOR ALL SWIM SUITS AND FREE EXPRESS INTERNATIONAL
          DELIVERY - OFF 50%! <a href="shop.html">SHOP NOW</a>
        </p>
      </div>
    </div>

    <div class="header-row">
      <div class="container">
        <div class="header-wrapper">
          <div class="header-mobile">
            <i class="bi bi-list" id="btn-menu"></i>
          </div>
          <div class="header-left">
            <a href="/" class="logo">Smart Shopping</a>
          </div>

          <div class="header-center" id="sidebar">
            <nav class="navigation">
              <ul class="menu-list">
                <li class="menu-list-item"><a href="/" class="menu-link">Home</a></li>
                <li class="menu-list-item"><a href="shop.html" class="menu-link">Shop</a></li>
                <li class="menu-list-item"><a href="blog.html" class="menu-link">Blog</a></li>
                <li class="menu-list-item"><a href="contact.html" class="menu-link">Contact</a></li>
              </ul>
            </nav>
            <i class="bi-x-circle" id="close-sidebar"></i>
          </div>

          <div class="header-right">
            <div class="header-right-links">
              <a href="account.html" id="accountLink"><i class="bi bi-person"></i></a>
              <button class="search-button"><i class="bi bi-search"></i></button>
              <a href="#"><i class="bi bi-heart"></i></a>
              <div class="header-cart">
                <a href="cart.html" class="header-cart-link">
                  <i class="bi bi-bag"></i>
                  <span class="header-cart-count">0</span>
                </a>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </header>

  <!-- profile content -->
  <section class="account-page">
    <div class="container">
      <div class="account-wrapper">
        <div class="account-column" style="width:100%;">
          <h2>My Profile</h2>

          <p><strong>Name:</strong> <span id="pName">Loading...</span></p>
          <p><strong>Email:</strong> <span id="pEmail">Loading...</span></p>
          <p><strong>UID:</strong> <span id="pUid">Loading...</span></p>

          <div style="margin-top:20px;">
            <button class="btn btn-sm" id="logoutBtn">Logout</button>
          </div>

          <hr style="margin:25px 0;" />

          <h2>My Orders</h2>
          <div id="ordersBox">Loading orders...</div>
        </div>
      </div>
    </div>
  </section>

  <script src="js/main.js" type="module"></script>

  <script type="module">
    import { auth, db } from "./js/firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import {
      collection,
      getDocs,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const pName = document.getElementById("pName");
    const pEmail = document.getElementById("pEmail");
    const pUid = document.getElementById("pUid");
    const ordersBox = document.getElementById("ordersBox");

    async function loadOrders(uid) {
      ordersBox.textContent = "Loading orders...";
      const q = query(collection(db, "users", uid, "orders"), orderBy("createdAt", "desc"));
      const snap = await getDocs(q);

      if (snap.empty) {
        ordersBox.innerHTML = "<p>No orders yet.</p>";
        return;
      }

      let html = "<ul style='padding-left:18px;'>";
      snap.forEach((docu) => {
        const o = docu.data();
        html += `<li style="margin-bottom:10px;">
          <strong>Status:</strong> ৳{o.status || "pending"} |
          <strong>Total:</strong> ৳{o.total || 0} |
          <strong>Items:</strong> ৳{(o.items || []).length}
        </li>`;
      });
      html += "</ul>";
      ordersBox.innerHTML = html;
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "account.html"; // ✅ not logged in
        return;
      }

      pName.textContent = user.displayName || "Customer";
      pEmail.textContent = user.email || "-";
      pUid.textContent = user.uid;

      await loadOrders(user.uid);
    });

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "account.html";
    });
  </script>
</body>

</html>
